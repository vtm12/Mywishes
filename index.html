<!DOCTYPE html>
<html lang="ru">
<head>
  <meta charset="UTF-8">
  <title>–†–∞–±–∞ –∂–µ–ª–∞–Ω–∏–π</title>
  <style>
    body {
      margin: 0;
      font-family: "Trebuchet MS", sans-serif;
      background-color: #111;
      color: #eee;
      display: flex;
      justify-content: center;
      align-items: center;
      height: 100vh;
    }
    .container { text-align: center; max-width: 600px; padding: 20px; }
    h1,h2,h3 { margin-bottom: 20px; }
    input, button {
      padding: 10px 15px;
      margin: 10px 0;
      border: none;
      border-radius: 5px;
      font-size: 16px;
    }
    input { width: 60%; }
    button { background-color: #c00; color: white; cursor: pointer; }
    button:hover { background-color: #900; }
    .hidden { display: none; }
    .reward-box { border: 2px solid #c00; padding: 15px; margin: 20px 0; background-color: #222; font-size: 18px; font-weight: bold; }
    .stats { margin-top: 20px; font-size: 14px; color: #bbb; }
  </style>
</head>
<body>
<div class="container">

  <!-- –≠–∫—Ä–∞–Ω 1: –Ω–∏–∫ -->
  <div id="screen-nick">
    <h1>–†–∞–±–∞ –∂–µ–ª–∞–Ω–∏–π</h1>
    <p>–í–≤–µ–¥–∏—Ç–µ —Å–≤–æ–π –Ω–∏–∫:</p>
    <input type="text" id="nickname" placeholder="–í–∞—à –Ω–∏–∫">
    <br>
    <button onclick="startGame()">–ù–∞—á–∞—Ç—å</button>
  </div>

  <!-- –≠–∫—Ä–∞–Ω 2: –≤—ã–±–æ—Ä –∂–µ–ª–∞–Ω–∏—è -->
  <div id="screen-choice" class="hidden">
    <h2 id="welcome"></h2>
    <p id="choice-text"></p>
    <input type="number" id="wishNumber" min="1">
    <br>
    <button onclick="chooseWish()">–í—ã–±—Ä–∞—Ç—å</button>
    <div class="stats" id="stats-panel"></div>
  </div>

  <!-- –≠–∫—Ä–∞–Ω 3: —Ä–µ–∑—É–ª—å—Ç–∞—Ç -->
  <div id="screen-result" class="hidden">
    <h3 id="wishText"></h3>
    <button onclick="completeWish(true)">‚úÖ –í—ã–ø–æ–ª–Ω–µ–Ω–æ</button>
    <button onclick="completeWish(false)">‚ùå –ù–µ –≤—ã–ø–æ–ª–Ω–µ–Ω–æ</button>
    <div id="reward-section" class="hidden">
      <h3>–í–∞—à–∞ –Ω–∞–≥—Ä–∞–¥–∞:</h3>
      <div class="reward-box" id="rewardText"></div>
      <button onclick="nextRound()">–ü—Ä–æ–¥–æ–ª–∂–∏—Ç—å</button>
    </div>
    <div id="fail-section" class="hidden">
      <h3>–¢—ã –æ—Ç–∫–∞–∑–∞–ª–∞—Å—å. -1 –±–∞–ª–ª</h3>
      <button onclick="nextRound()">–ü—Ä–æ–¥–æ–ª–∂–∏—Ç—å</button>
    </div>
    <div class="stats" id="stats-panel2"></div>
  </div>

</div>

<script>
let wishes = [];
let rewards = [];
let currentPlayer = "";
let currentWishIndex = -1;
let stats = JSON.parse(localStorage.getItem("stats")) || {};

// –ó–∞–≥—Ä—É–∑–∫–∞ JSON
async function loadData() {
  try {
    wishes = await fetch("wishes.json?v=" + Date.now()).then(r => r.json());
    rewards = await fetch("rewards.json?v=" + Date.now()).then(r => r.json());
  } catch (e) {
    alert("–û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏ wishes.json / rewards.json. –ü—Ä–æ–≤–µ—Ä—å —Ñ–∞–π–ª—ã!");
    console.error(e);
    wishes = [];
    rewards = [];
  }
}

async function startGame() {
  if (wishes.length === 0) {
    await loadData();
  }

  if (wishes.length === 0) {
    alert("–§–∞–π–ª wishes.json –ø—É—Å—Ç –∏–ª–∏ –Ω–µ –Ω–∞–π–¥–µ–Ω!");
    return;
  }

  currentPlayer = document.getElementById("nickname").value.trim();
  if (!currentPlayer) {
    alert("–í–≤–µ–¥–∏—Ç–µ –Ω–∏–∫!");
    return;
  }
  if (!stats[currentPlayer]) {
    stats[currentPlayer] = { score: 0, completed: 0, failed: 0, doneWishes: [] };
  }

  document.getElementById("screen-nick").classList.add("hidden");
  document.getElementById("screen-choice").classList.remove("hidden");
  document.getElementById("welcome").innerText = "–ü—Ä–∏–≤–µ—Ç, " + currentPlayer + "!";
  updateChoiceText();
  updateStats();
}

function updateChoiceText() {
  if (wishes.length > 0) {
    document.getElementById("choice-text").innerText = "–í—ã–±–µ—Ä–∏ —á–∏—Å–ª–æ –æ—Ç 1 –¥–æ " + wishes.length;
  } else {
    document.getElementById("choice-text").innerText = "–ñ–µ–ª–∞–Ω–∏—è –∑–∞–∫–æ–Ω—á–∏–ª–∏—Å—å!";
  }
}

function chooseWish() {
  if (wishes.length === 0) {
    alert("–ñ–µ–ª–∞–Ω–∏—è –∑–∞–∫–æ–Ω—á–∏–ª–∏—Å—å!");
    return;
  }

  const num = parseInt(document.getElementById("wishNumber").value);
  if (isNaN(num) || num < 1 || num > wishes.length) {
    alert("–í–≤–µ–¥–∏—Ç–µ –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ–µ —á–∏—Å–ª–æ!");
    return;
  }

  currentWishIndex = num - 1;
  document.getElementById("wishText").innerText = "–ñ–µ–ª–∞–Ω–∏–µ: " + wishes[currentWishIndex];

  document.getElementById("screen-choice").classList.add("hidden");
  document.getElementById("screen-result").classList.remove("hidden");
  document.getElementById("reward-section").classList.add("hidden");
  document.getElementById("fail-section").classList.add("hidden");
  updateStats();
}

function completeWish(success) {
  if (currentWishIndex === -1) return;

  if (success) {
    let wish = wishes.splice(currentWishIndex, 1)[0]; // —É–¥–∞–ª—è–µ–º –∂–µ–ª–∞–Ω–∏–µ
    stats[currentPlayer].doneWishes.push(wish);
    stats[currentPlayer].score += 2;
    stats[currentPlayer].completed++;
    if (rewards.length > 0) {
      let randIndex = Math.floor(Math.random() * rewards.length);
      let reward = rewards[randIndex];
      rewards.splice(randIndex, 1); // —É–¥–∞–ª—è–µ–º –Ω–∞–≥—Ä–∞–¥—É
      document.getElementById("rewardText").innerText = reward;
      document.getElementById("reward-section").classList.remove("hidden");
    } else {
      document.getElementById("rewardText").innerText = "–ù–∞–≥—Ä–∞–¥—ã –∑–∞–∫–æ–Ω—á–∏–ª–∏—Å—å!";
      document.getElementById("reward-section").classList.remove("hidden");
    }
  } else {
    stats[currentPlayer].score -= 1;
    stats[currentPlayer].failed++;
    document.getElementById("fail-section").classList.remove("hidden");
  }
  saveStats();
  updateStats();
}

function nextRound() {
  document.getElementById("screen-result").classList.add("hidden");
  document.getElementById("screen-choice").classList.remove("hidden");
  updateChoiceText();
}

function updateStats() {
  const player = stats[currentPlayer];
  const text = `üë§ ${currentPlayer} | –û—á–∫–∏: ${player.score} | –í—ã–ø–æ–ª–Ω–µ–Ω–æ: ${player.completed} | –ü—Ä–æ–≤–∞–ª—ã: ${player.failed}`;
  document.getElementById("stats-panel").innerText = text;
  document.getElementById("stats-panel2").innerText = text;
}

function saveStats() {
  localStorage.setItem("stats", JSON.stringify(stats));
}
</script>
</body>
</html>








